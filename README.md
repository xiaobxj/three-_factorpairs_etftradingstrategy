## 第一层：数据与因子池构建（Universe Construction）

- **资产：** 选取 ETF 或构建多空组合：(Mom, Rev), (Val, Grw), (Big, Sml)  
- **数据准备：** 准备两套特征集  
  - **识别用特征（极简）：** 仅使用因子对的相对累计收益、波动率  
  - **预测用特征（宏观）：** 加入 VIX、期限利差（10Y–2Y）、信用利差、以及大宗商品价格  

---

## 第二层：并行体制识别（Parallel Regime Identification）

- 不使用单一模型刻画整体市场，而是建立 **3 个并行的 JM（这里因为聚宽没有现成，所以替换成HMM） 模型**：  
  1. **Model A：** 识别 Mom / Rev 的相对强弱（输出状态 $S_A \in \{0,1\}$）  
  2. **Model B：** 识别 Val / Grw 的相对强弱（输出状态 $S_B \in \{0,1\}$）  
  3. **Model C：** 识别 Big / Sml 的相对强弱（输出状态 $S_C \in \{0,1\}$）  

- **核心逻辑：**  
  市场状态不再是单一的 Bull / Bear，而是由三个维度构成的状态向量  
  \[
  \mathbf{S}_t = (S_A, S_B, S_C)
  \]

---

## 第三层：独立预测（Independent Forecasting）

- 训练 **3 个独立的 XGBoost 分类器**  
- **输入：** 宏观特征 + 对应的滞后体制标签  
- **输出：** 下一期每个因子对中哪一侧占优  
  - 例如：预测 Mom 是否优于 Rev，Val 是否优于 Grw，Small 是否优于 Big  

---

## 第四层：组合聚合（Portfolio Aggregation）

- 根据实证结果，采用 **等权聚合（Equal Weighting）**  

- **策略构建：**  
  设总资金为 1，将其平均分为 3 份（每份 1/3），分别配置到三个因子对：  
  - **子策略 1（Mom / Rev）：** 若 XGBoost 预测 Mom 占优，则配置 Mom（1/3 仓位）  
  - **子策略 2（Val / Grw）：** 若 XGBoost 预测 Val 占优，则配置 Val（1/3 仓位）  
  - **子策略 3（Size）：** 若 XGBoost 预测 Small 占优，则配置 Small（1/3 仓位）  

- **最终持仓：**  
  组合持仓为三个子策略的加总。  
  - 示例：若预测结果为 (Mom, Val, Small) 占优，则组合为  
    \[
    33\% \ \text{Mom} + 33\% \ \text{Val} + 33\% \ \text{Small}
    \]

- **优势：**  
  多维因子轮动带来结构性分散化。即便在价值 / 成长维度判断失误，动量 / 反转维度仍可能贡献收益。实证结果显示，多因子组合的夏普比率（1.0224）显著高于单一维度策略。

---

## 第五层：回测与风控

- **交易成本：**  
  回测中加入 5 bps 的单边交易成本。  

- **参数调优（并没有实现）：**  
  重点调整 JM 模型中的跳跃惩罚参数（Jump Penalty, $\lambda$）。  
  通过最大化夏普比率来动态选择 $\lambda$，该参数控制体制切换频率：  
  - 过高：体制切换过慢，可能错失市场变化  
  - 过低：切换过快，交易成本侵蚀收益  



### 回测结果

![image-20260210224059561](C:\Users\44327\AppData\Roaming\Typora\typora-user-images\image-20260210224059561.png)
